import React, { useState } from 'react';
import { formatCurrency, formatDate } from '../utils/constants';
import { Icon, Card, StatCard } from '../components/shared';

const FarmerManagementScreen = ({ state, setState, notify }) => {
  const [form, setForm] = useState({ name: '', mobile: '', address: '', advance: '' });
  const [editingId, setEditingId] = useState(null);

  const handleSubmit = (e) => {
    e.preventDefault();
    const newFarmer = {
      id: editingId || Date.now().toString(),
      ...form,
      active: true
    };

    if (editingId) {
      setState(prev => ({
        ...prev,
        farmers: prev.farmers.map(f => f.id === editingId ? newFarmer : f)
      }));
      notify("Farmer updated");
    } else {
      setState(prev => ({
        ...prev,
        farmers: [...prev.farmers, newFarmer]
      }));
      notify("New farmer added");
    }

    setForm({ name: '', mobile: '', address: '', advance: '' });
    setEditingId(null);
  };

  const handleEdit = (farmer) => {
    setForm({
      name: farmer.name,
      mobile: farmer.mobile,
      address: farmer.address,
      advance: farmer.advance
    });
    setEditingId(farmer.id);
  };

  const handleDelete = (id) => {
    if (confirm("Are you sure you want to delete this farmer?")) {
      setState(prev => ({
        ...prev,
        farmers: prev.farmers.map(f => f.id === id ? { ...f, active: false } : f)
      }));
      notify("Farmer deactivated");
    }
  };

  return (
    <div className="max-w-6xl mx-auto">
      <Card title="Farmer Registration">
        <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div className="lg:col-span-2">
            <label className="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Name</label>
            <input 
              type="text" 
              required 
              className="w-full p-3 bg-slate-50 border rounded-xl font-bold" 
              value={form.name} 
              onChange={e => setForm({...form, name: e.target.value})} 
            />
          </div>
          <div>
            <label className="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Mobile</label>
            <input 
              type="text" 
              required 
              className="w-full p-3 bg-slate-50 border rounded-xl font-bold" 
              value={form.mobile} 
              onChange={e => setForm({...form, mobile: e.target.value})} 
            />
          </div>
          <div className="flex items-end">
            <button 
              type="submit" 
              className="w-full py-4 bg-blue-600 text-white rounded-xl font-black hover:bg-blue-700"
            >{editingId ? "Update Farmer" : "Add Farmer"}</button>
          </div>
          <div className="lg:col-span-4">
            <label className="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Address</label>
            <input 
              type="text" 
              className="w-full p-3 bg-slate-50 border rounded-xl font-bold" 
              value={form.address} 
              onChange={e => setForm({...form, address: e.target.value})} 
            />
          </div>
          <div className="lg:col-span-4">
            <label className="block text-xs font-black text-slate-400 uppercase tracking-widest mb-2">Advance (â‚¹)</label>
            <input 
              type="number" 
              step="0.01" 
              className="w-full p-3 bg-slate-50 border rounded-xl font-bold text-rose-600" 
              value={form.advance} 
              onChange={e => setForm({...form, advance: e.target.value})} 
            />
          </div>
        </form>
      </Card>
      <Card title="Active Farmers">
        <div className="overflow-x-auto">
          <table className="w-full text-left">
            <thead className="border-b text-[10px] font-black text-slate-400 uppercase">
              <tr>
                <th className="pb-4">Name</th>
                <th className="pb-4">Mobile</th>
                <th className="pb-4">Address</th>
                <th className="pb-4">Advance</th>
                <th className="pb-4 text-right">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y">
              {state.farmers.filter(f => f.active).map(farmer => 
                <tr key={farmer.id}>
                  <td className="py-4 font-black">{farmer.name}</td>
                  <td className="py-4 font-bold text-slate-500">{farmer.mobile}</td>
                  <td className="py-4 font-bold text-slate-500">{farmer.address}</td>
                  <td className="py-4 font-black text-rose-600">{formatCurrency(farmer.advance)}</td>
                  <td className="py-4 text-right space-x-3">
                    <button 
                      onClick={() => handleEdit(farmer)}
                      className="text-blue-600 font-bold hover:underline text-sm"
                    >Edit</button>
                    <button 
                      onClick={() => handleDelete(farmer.id)}
                      className="text-red-600 font-bold hover:underline text-sm"
                    >Delete</button>
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </Card>
    </div>
  );
};

export default FarmerManagementScreen;